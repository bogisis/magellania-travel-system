# Системная архитектура

## 🏗 Общая архитектура

MAGELLANIA Travel System построена на современной архитектуре с разделением на frontend и backend компоненты.

### Архитектурная схема

```
┌─────────────────┐    HTTP/HTTPS    ┌─────────────────┐
│   Frontend      │ ◄──────────────► │   Backend       │
│   (Vue.js 3)    │                  │   (Express.js)  │
└─────────────────┘                  └─────────────────┘
         │                                     │
         │                                     │
         ▼                                     ▼
┌─────────────────┐                  ┌─────────────────┐
│   IndexedDB     │                  │   SQLite        │
│   (Локальное    │                  │   (Основная БД) │
│    кеширование) │                  │                 │
└─────────────────┘                  └─────────────────┘
```

## 🎯 Принципы архитектуры

### 1. Разделение ответственности

- **Frontend**: Пользовательский интерфейс и клиентская логика
- **Backend**: API и бизнес-логика
- **Database**: Хранение и управление данными

### 2. Модульность

- Каждый компонент имеет четко определенную ответственность
- Минимальная связанность между модулями
- Высокая когезия внутри модулей

### 3. Масштабируемость

- Горизонтальное масштабирование backend
- Вертикальное масштабирование frontend
- Независимое масштабирование компонентов

## 🎨 Frontend архитектура

### Технологический стек

- **Framework**: Vue.js 3 с Composition API
- **State Management**: Pinia
- **Routing**: Vue Router 4
- **Styling**: Tailwind CSS
- **Build Tool**: Vite
- **Icons**: Lucide Vue Next

### Структура приложения

```
src/
├── components/          # Vue компоненты
│   ├── common/         # Общие компоненты
│   ├── estimates/      # Компоненты смет
│   ├── clients/        # Компоненты клиентов
│   └── suppliers/      # Компоненты поставщиков
├── views/              # Страницы приложения
├── stores/             # Pinia stores
├── services/           # Бизнес-сервисы
├── utils/              # Утилиты
├── router/             # Конфигурация роутинга
└── styles/             # Стили
```

### Принципы компонентной архитектуры

1. **Единая ответственность**: Каждый компонент отвечает за одну функцию
2. **Переиспользование**: Компоненты должны быть переиспользуемыми
3. **Пропсы вниз, события вверх**: Однонаправленный поток данных
4. **Композиция над наследованием**: Использование Composition API

## 🔧 Backend архитектура

### Технологический стек

- **Framework**: Express.js
- **Database**: SQLite
- **Authentication**: JWT (планируется)
- **Validation**: Встроенная валидация
- **CORS**: Настроен для разработки

### Структура API

```
api-server/
├── working-server.js   # Основной сервер
├── routes/             # API маршруты
├── database/           # База данных
├── middleware/         # Middleware
└── utils/              # Утилиты
```

### API принципы

1. **RESTful**: Следование REST принципам
2. **JSON**: Все данные в формате JSON
3. **HTTP статусы**: Правильное использование HTTP кодов
4. **Валидация**: Валидация всех входящих данных

## 🗄 Архитектура данных

### Двухуровневая система хранения

#### 1. SQLite (Основная БД)

- **Назначение**: Основное хранилище данных
- **Преимущества**: Надежность, ACID транзакции
- **Использование**: Все критические данные

#### 2. IndexedDB (Локальное кеширование)

- **Назначение**: Кеширование и офлайн работа
- **Преимущества**: Быстрый доступ, офлайн режим
- **Использование**: Временные данные, кеш

### Синхронизация данных

```javascript
// Пример синхронизации
async function syncData() {
  // 1. Загружаем данные из SQLite
  const serverData = await apiService.getData()

  // 2. Сохраняем в IndexedDB
  await localDb.data.bulkPut(serverData)

  // 3. Обновляем UI
  store.updateData(serverData)
}
```

## 🔄 Поток данных

### 1. Чтение данных

```
UI → Store → API Service → Backend → SQLite
```

### 2. Запись данных

```
UI → Store → API Service → Backend → SQLite → Response → Store → UI
```

### 3. Кеширование

```
UI → Store → IndexedDB (если есть) → API Service (если нет) → Backend
```

## 🛡 Безопасность

### Текущие меры

- **CORS**: Настроен для разрешенных доменов
- **Валидация**: Валидация всех входящих данных
- **Санитизация**: Очистка пользовательского ввода

### Планируемые меры

- **JWT Authentication**: Система аутентификации
- **Rate Limiting**: Ограничение запросов
- **HTTPS**: Шифрование трафика
- **SQL Injection Protection**: Защита от SQL инъекций

## 📊 Мониторинг и логирование

### Логирование

- **Frontend**: Console.log для разработки
- **Backend**: Структурированные логи
- **Errors**: Централизованная обработка ошибок

### Мониторинг

- **Health Checks**: Проверка состояния сервисов
- **Performance**: Мониторинг производительности
- **Errors**: Отслеживание ошибок

## 🚀 Развертывание

### Development

- **Frontend**: Vite dev server (localhost:5173)
- **Backend**: Express.js (localhost:3001)
- **Database**: SQLite файл

### Production

- **Frontend**: Nginx + статические файлы
- **Backend**: PM2 + Node.js
- **Database**: SQLite (может быть заменена на PostgreSQL)

## 📈 Масштабирование

### Горизонтальное масштабирование

- **Load Balancer**: Распределение нагрузки
- **Multiple Backend Instances**: Несколько экземпляров API
- **Database Clustering**: Кластеризация базы данных

### Вертикальное масштабирование

- **Resource Optimization**: Оптимизация ресурсов
- **Caching**: Кеширование на всех уровнях
- **CDN**: Content Delivery Network

---

**Версия**: 2.0.0  
**Последнее обновление**: 2024-08-28  
**Автор**: MAGELLANIA Development Team
